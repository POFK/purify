#include "purify/config.h"
#include <iostream>
#include "catch.hpp"
#include "purify/directories.h"
#include "purify/logging.h"
#include "purify/types.h"
#include "purify/wproj_utilities.h"
using namespace purify;
using namespace purify::notinstalled;

TEST_CASE("wprojection_matrix") {
  //! test if convolution is identity 
  const Vector<t_real> w_components = Vector<t_real>::Random(12);
  const Vector<t_real> w_components_zero = w_components * 0;
  const t_int Nx = 128;
  const t_int Ny = 128;
  const t_int rows = w_components.size();
  const t_int cols = Nx * Ny;

  Sparse<t_complex> I(rows, cols);
  I.reserve(Vector<t_int>::Constant(rows, 1));
  for (t_int i = 0; i < std::min(rows, cols); i++) {
    I.coeffRef(i, i) = 1;
  }

  auto const G_id = wproj_utilities::wprojection_matrix(I, Nx, Ny,
      w_components_zero, 10, 10, 0.9, 0.9);
  auto const G = wproj_utilities::wprojection_matrix(I, Nx, Ny,
      w_components, 10, 10, 0.9, 0.9);
  //Testing if G_id == I
  CHECK(G_id.nonZeros() == I.nonZeros());
  CHECK(G.nonZeros() >= I.nonZeros());
  for (t_int k = 0; k < G.outerSize(); ++k)
    for (Sparse<t_complex>::InnerIterator it(G_id, k); it; ++it)
    {
      CHECK(it.value() == 1.);
      CHECK(it.row() == it.col());   // row index
    }
}

TEST_CASE("convolution"){

  //Testing row-wise convolution
  const t_int Nx = 32;
  const t_int Ny = 32;
  const std::vector<t_real> grid_ind = {5.800000000000E+02,
    5.810000000000E+02,
    5.820000000000E+02,
    5.830000000000E+02,
    5.840000000000E+02,
    5.850000000000E+02,
    5.860000000000E+02,
    5.870000000000E+02,
    6.120000000000E+02,
    6.130000000000E+02,
    6.140000000000E+02,
    6.150000000000E+02,
    6.160000000000E+02,
    6.170000000000E+02,
    6.180000000000E+02,
    6.190000000000E+02,
    6.440000000000E+02,
    6.450000000000E+02,
    6.460000000000E+02,
    6.470000000000E+02,
    6.480000000000E+02,
    6.490000000000E+02,
    6.500000000000E+02,
    6.510000000000E+02,
    6.760000000000E+02,
    6.770000000000E+02,
    6.780000000000E+02,
    6.790000000000E+02,
    6.800000000000E+02,
    6.810000000000E+02,
    6.820000000000E+02,
    6.830000000000E+02,
    7.080000000000E+02,
    7.090000000000E+02,
    7.100000000000E+02,
    7.110000000000E+02,
    7.120000000000E+02,
    7.130000000000E+02,
    7.140000000000E+02,
    7.150000000000E+02,
    7.400000000000E+02,
    7.410000000000E+02,
    7.420000000000E+02,
    7.430000000000E+02,
    7.440000000000E+02,
    7.450000000000E+02,
    7.460000000000E+02,
    7.470000000000E+02,
    7.720000000000E+02,
    7.730000000000E+02,
    7.740000000000E+02,
    7.750000000000E+02,
    7.760000000000E+02,
    7.770000000000E+02,
    7.780000000000E+02,
    7.790000000000E+02,
    8.040000000000E+02,
    8.050000000000E+02,
    8.060000000000E+02,
    8.070000000000E+02,
    8.080000000000E+02,
    8.090000000000E+02,
    8.100000000000E+02,
    8.110000000000E+02};

  const std::vector<t_real> grid_values = {4.754972136091E-09,
    -2.677919681207E-07 ,
    2.075856007646E-06,
    -4.312493422250E-06 ,
    2.814072250773E-06,
    -5.276419239891E-07 ,
    1.780973741993E-08,
    -7.406147300136E-12 ,
    -6.005045453883E-06 ,
    3.381939777405E-04,
    -2.621594685491E-03 ,
    5.446239910351E-03,
    -3.553886603907E-03 ,
    6.663580030006E-04,
    -2.249188421456E-05 ,
    9.353209630379E-09,
    1.542780442127E-04,
    -8.688677854484E-03 ,
    6.735244618913E-02,
    -1.399215456627E-01 ,
    9.130433379983E-02,
    -1.711967215534E-02 ,
    5.778480669179E-04,
    -2.402970801750E-07 ,
    -7.522881955962E-04 ,
    4.236759558771E-02,
    -3.284229487817E-01 ,
    6.822832610355E-01,
    -4.452167699876E-01 ,
    8.347867864585E-02,
    -2.817693741250E-03 ,
    1.171732878611E-06,
    1.068801592551E-03,
    -6.019309342054E-02 ,
    4.666017262307E-01,
    -9.693431855429E-01 ,
    6.325347062185E-01,
    -1.186010164762E-01 ,
    4.003193956250E-03,
    -1.664721012552E-06 ,
    -4.758266005124E-04 ,
    2.679774732396E-02,
    -2.077293996687E-01 ,
    4.315480776988E-01,
    -2.816021617705E-01 ,
    5.280074326281E-02,
    -1.782207459897E-03 ,
    7.411277693869E-07,
    5.555053489915E-05,
    -3.128511933413E-03 ,
    2.425143792602E-02,
    -5.038122401113E-02 ,
    3.287573813289E-02,
    -6.164240351766E-03 ,
    2.080644032762E-04,
    -8.652320818912E-08 ,
    -8.182099662432E-07 ,
    4.608019793286E-05,
    -3.572021087254E-04 ,
    7.420706150224E-04,
    -4.842303793612E-04 ,
    9.079377722086E-05,
    -3.064603584647E-06 ,
    1.274409893266E-09};
  const std::vector<t_real> chirp_ind ={2.370000000000E+02,
    2.380000000000E+02,
    2.390000000000E+02,
    2.400000000000E+02,
    2.410000000000E+02,
    2.420000000000E+02,
    2.430000000000E+02,
    2.670000000000E+02,
    2.680000000000E+02,
    2.690000000000E+02,
    2.700000000000E+02,
    2.710000000000E+02,
    2.720000000000E+02,
    2.730000000000E+02,
    2.740000000000E+02,
    2.750000000000E+02,
    2.760000000000E+02,
    2.770000000000E+02,
    2.980000000000E+02,
    2.990000000000E+02,
    3.000000000000E+02,
    3.010000000000E+02,
    3.020000000000E+02,
    3.030000000000E+02,
    3.040000000000E+02,
    3.050000000000E+02,
    3.060000000000E+02,
    3.070000000000E+02,
    3.080000000000E+02,
    3.090000000000E+02,
    3.100000000000E+02,
    3.290000000000E+02,
    3.300000000000E+02,
    3.310000000000E+02,
    3.320000000000E+02,
    3.330000000000E+02,
    3.340000000000E+02,
    3.350000000000E+02,
    3.360000000000E+02,
    3.370000000000E+02,
    3.380000000000E+02,
    3.390000000000E+02,
    3.400000000000E+02,
    3.410000000000E+02,
    3.420000000000E+02,
    3.430000000000E+02,
    3.600000000000E+02,
    3.610000000000E+02,
    3.620000000000E+02,
    3.630000000000E+02,
    3.640000000000E+02,
    3.650000000000E+02,
    3.660000000000E+02,
    3.670000000000E+02,
    3.680000000000E+02,
    3.690000000000E+02,
    3.700000000000E+02,
    3.710000000000E+02,
    3.720000000000E+02,
    3.730000000000E+02,
    3.740000000000E+02,
    3.750000000000E+02,
    3.760000000000E+02,
    3.920000000000E+02,
    3.930000000000E+02,
    3.940000000000E+02,
    3.950000000000E+02,
    3.960000000000E+02,
    3.970000000000E+02,
    3.980000000000E+02,
    3.990000000000E+02,
    4.000000000000E+02,
    4.010000000000E+02,
    4.020000000000E+02,
    4.030000000000E+02,
    4.040000000000E+02,
    4.050000000000E+02,
    4.060000000000E+02,
    4.070000000000E+02,
    4.080000000000E+02,
    4.230000000000E+02,
    4.240000000000E+02,
    4.250000000000E+02,
    4.260000000000E+02,
    4.270000000000E+02,
    4.280000000000E+02,
    4.290000000000E+02,
    4.300000000000E+02,
    4.310000000000E+02,
    4.320000000000E+02,
    4.330000000000E+02,
    4.340000000000E+02,
    4.350000000000E+02,
    4.360000000000E+02,
    4.370000000000E+02,
    4.380000000000E+02,
    4.390000000000E+02,
    4.400000000000E+02,
    4.410000000000E+02,
    4.550000000000E+02,
    4.560000000000E+02,
    4.570000000000E+02,
    4.580000000000E+02,
    4.590000000000E+02,
    4.600000000000E+02,
    4.610000000000E+02,
    4.620000000000E+02,
    4.630000000000E+02,
    4.640000000000E+02,
    4.650000000000E+02,
    4.660000000000E+02,
    4.670000000000E+02,
    4.680000000000E+02,
    4.690000000000E+02,
    4.700000000000E+02,
    4.710000000000E+02,
    4.720000000000E+02,
    4.730000000000E+02,
    4.870000000000E+02,
    4.880000000000E+02,
    4.890000000000E+02,
    4.900000000000E+02,
    4.910000000000E+02,
    4.920000000000E+02,
    4.930000000000E+02,
    4.940000000000E+02,
    4.950000000000E+02,
    4.960000000000E+02,
    4.970000000000E+02,
    4.980000000000E+02,
    4.990000000000E+02,
    5.000000000000E+02,
    5.010000000000E+02,
    5.020000000000E+02,
    5.030000000000E+02,
    5.040000000000E+02,
    5.050000000000E+02,
    5.190000000000E+02,
    5.200000000000E+02,
    5.210000000000E+02,
    5.220000000000E+02,
    5.230000000000E+02,
    5.240000000000E+02,
    5.250000000000E+02,
    5.260000000000E+02,
    5.270000000000E+02,
    5.280000000000E+02,
    5.290000000000E+02,
    5.300000000000E+02,
    5.310000000000E+02,
    5.320000000000E+02,
    5.330000000000E+02,
    5.340000000000E+02,
    5.350000000000E+02,
    5.360000000000E+02,
    5.370000000000E+02,
    5.510000000000E+02,
    5.520000000000E+02,
    5.530000000000E+02,
    5.540000000000E+02,
    5.550000000000E+02,
    5.560000000000E+02,
    5.570000000000E+02,
    5.580000000000E+02,
    5.590000000000E+02,
    5.600000000000E+02,
    5.610000000000E+02,
    5.620000000000E+02,
    5.630000000000E+02,
    5.640000000000E+02,
    5.650000000000E+02,
    5.660000000000E+02,
    5.670000000000E+02,
    5.680000000000E+02,
    5.690000000000E+02,
    5.830000000000E+02,
    5.840000000000E+02,
    5.850000000000E+02,
    5.860000000000E+02,
    5.870000000000E+02,
    5.880000000000E+02,
    5.890000000000E+02,
    5.900000000000E+02,
    5.910000000000E+02,
    5.920000000000E+02,
    5.930000000000E+02,
    5.940000000000E+02,
    5.950000000000E+02,
    5.960000000000E+02,
    5.970000000000E+02,
    5.980000000000E+02,
    5.990000000000E+02,
    6.000000000000E+02,
    6.010000000000E+02,
    6.150000000000E+02,
    6.160000000000E+02,
    6.170000000000E+02,
    6.180000000000E+02,
    6.190000000000E+02,
    6.200000000000E+02,
    6.210000000000E+02,
    6.220000000000E+02,
    6.230000000000E+02,
    6.240000000000E+02,
    6.250000000000E+02,
    6.260000000000E+02,
    6.270000000000E+02,
    6.280000000000E+02,
    6.290000000000E+02,
    6.300000000000E+02,
    6.310000000000E+02,
    6.320000000000E+02,
    6.330000000000E+02,
    6.480000000000E+02,
    6.490000000000E+02,
    6.500000000000E+02,
    6.510000000000E+02,
    6.520000000000E+02,
    6.530000000000E+02,
    6.540000000000E+02,
    6.550000000000E+02,
    6.560000000000E+02,
    6.570000000000E+02,
    6.580000000000E+02,
    6.590000000000E+02,
    6.600000000000E+02,
    6.610000000000E+02,
    6.620000000000E+02,
    6.630000000000E+02,
    6.640000000000E+02,
    6.800000000000E+02,
    6.810000000000E+02,
    6.820000000000E+02,
    6.830000000000E+02,
    6.840000000000E+02,
    6.850000000000E+02,
    6.860000000000E+02,
    6.870000000000E+02,
    6.880000000000E+02,
    6.890000000000E+02,
    6.900000000000E+02,
    6.910000000000E+02,
    6.920000000000E+02,
    6.930000000000E+02,
    6.940000000000E+02,
    6.950000000000E+02,
    6.960000000000E+02,
    7.130000000000E+02,
    7.140000000000E+02,
    7.150000000000E+02,
    7.160000000000E+02,
    7.170000000000E+02,
    7.180000000000E+02,
    7.190000000000E+02,
    7.200000000000E+02,
    7.210000000000E+02,
    7.220000000000E+02,
    7.230000000000E+02,
    7.240000000000E+02,
    7.250000000000E+02,
    7.260000000000E+02,
    7.270000000000E+02,
    7.460000000000E+02,
    7.470000000000E+02,
    7.480000000000E+02,
    7.490000000000E+02,
    7.500000000000E+02,
    7.510000000000E+02,
    7.520000000000E+02,
    7.530000000000E+02,
    7.540000000000E+02,
    7.550000000000E+02,
    7.560000000000E+02,
    7.570000000000E+02,
    7.580000000000E+02,
    7.790000000000E+02,
    7.800000000000E+02,
    7.810000000000E+02,
    7.820000000000E+02,
    7.830000000000E+02,
    7.840000000000E+02,
    7.850000000000E+02,
    7.860000000000E+02,
    7.870000000000E+02,
    7.880000000000E+02,
    7.890000000000E+02,
    8.130000000000E+02,
    8.140000000000E+02,
    8.150000000000E+02,
    8.160000000000E+02,
    8.170000000000E+02,
    8.180000000000E+02,
    8.190000000000E+02};
  const std::vector<t_real> chirp_values = {1.300729765407E-05,
    2.430083125933E-05,
    3.535750085041E-05,
    4.006529739295E-05,
    3.535750085041E-05,
    2.430083125933E-05,
    1.300729765407E-05,
    1.473919921529E-05,
    4.539992976248E-05,
    1.089087698551E-04,
    2.034683690106E-04,
    2.960447300569E-04,
    3.354626279025E-04,
    2.960447300569E-04,
    2.034683690106E-04,
    1.089087698551E-04,
    4.539992976248E-05,
    1.473919921529E-05,
    2.430083125933E-05,
    9.611165206139E-05,
    2.960447300569E-04,
    7.101743888425E-04,
    1.326780431027E-03,
    1.930454136228E-03,
    2.187491118183E-03,
    1.930454136228E-03,
    1.326780431027E-03,
    7.101743888425E-04,
    2.960447300569E-04,
    9.611165206139E-05,
    2.430083125933E-05,
    2.430083125933E-05,
    1.234098040867E-04,
    4.880952435234E-04,
    1.503439192978E-03,
    3.606563136016E-03,
    6.737946999085E-03,
    9.803655035822E-03,
    1.110899653824E-02,
    9.803655035822E-03,
    6.737946999085E-03,
    3.606563136016E-03,
    1.503439192978E-03,
    4.880952435234E-04,
    1.234098040867E-04,
    2.430083125933E-05,
    1.473919921529E-05,
    9.611165206139E-05,
    4.880952435234E-04,
    1.930454136228E-03,
    5.946217356472E-03,
    1.426423390900E-02,
    2.664909733636E-02,
    3.877420783172E-02,
    4.393693362341E-02,
    3.877420783172E-02,
    2.664909733636E-02,
    1.426423390900E-02,
    5.946217356472E-03,
    1.930454136228E-03,
    4.880952435234E-04,
    9.611165206139E-05,
    1.473919921529E-05,
    4.539992976248E-05,
    2.960447300569E-04,
    1.503439192978E-03,
    5.946217356472E-03,
    1.831563888873E-02,
    4.393693362341E-02,
    8.208499862390E-02,
    1.194329682667E-01,
    1.353352832366E-01,
    1.194329682667E-01,
    8.208499862390E-02,
    4.393693362341E-02,
    1.831563888873E-02,
    5.946217356472E-03,
    1.503439192978E-03,
    2.960447300569E-04,
    4.539992976248E-05,
    1.300729765407E-05,
    1.089087698551E-04,
    7.101743888425E-04,
    3.606563136016E-03,
    1.426423390900E-02,
    4.393693362341E-02,
    1.053992245619E-01,
    1.969116752042E-01,
    2.865047968602E-01,
    3.246524673584E-01,
    2.865047968602E-01,
    1.969116752042E-01,
    1.053992245619E-01,
    4.393693362341E-02,
    1.426423390900E-02,
    3.606563136016E-03,
    7.101743888425E-04,
    1.089087698551E-04,
    1.300729765407E-05,
    2.430083125933E-05,
    2.034683690106E-04,
    1.326780431027E-03,
    6.737946999085E-03,
    2.664909733636E-02,
    8.208499862390E-02,
    1.969116752042E-01,
    3.678794411714E-01,
    5.352614285190E-01,
    6.065306597126E-01,
    5.352614285190E-01,
    3.678794411714E-01,
    1.969116752042E-01,
    8.208499862390E-02,
    2.664909733636E-02,
    6.737946999085E-03,
    1.326780431027E-03,
    2.034683690106E-04,
    2.430083125933E-05,
    3.535750085041E-05,
    2.960447300569E-04,
    1.930454136228E-03,
    9.803655035822E-03,
    3.877420783172E-02,
    1.194329682667E-01,
    2.865047968602E-01,
    5.352614285190E-01,
    7.788007830714E-01,
    8.824969025846E-01,
    7.788007830714E-01,
    5.352614285190E-01,
    2.865047968602E-01,
    1.194329682667E-01,
    3.877420783172E-02,
    9.803655035822E-03,
    1.930454136228E-03,
    2.960447300569E-04,
    3.535750085041E-05,
    4.006529739295E-05,
    3.354626279025E-04,
    2.187491118183E-03,
    1.110899653824E-02,
    4.393693362341E-02,
    1.353352832366E-01,
    3.246524673584E-01,
    6.065306597126E-01,
    8.824969025846E-01,
    1.000000000000E+00,
    8.824969025846E-01,
    6.065306597126E-01,
    3.246524673584E-01,
    1.353352832366E-01,
    4.393693362341E-02,
    1.110899653824E-02,
    2.187491118183E-03,
    3.354626279025E-04,
    4.006529739295E-05,
    3.535750085041E-05,
    2.960447300569E-04,
    1.930454136228E-03,
    9.803655035822E-03,
    3.877420783172E-02,
    1.194329682667E-01,
    2.865047968602E-01,
    5.352614285190E-01,
    7.788007830714E-01,
    8.824969025846E-01,
    7.788007830714E-01,
    5.352614285190E-01,
    2.865047968602E-01,
    1.194329682667E-01,
    3.877420783172E-02,
    9.803655035822E-03,
    1.930454136228E-03,
    2.960447300569E-04,
    3.535750085041E-05,
    2.430083125933E-05,
    2.034683690106E-04,
    1.326780431027E-03,
    6.737946999085E-03,
    2.664909733636E-02,
    8.208499862390E-02,
    1.969116752042E-01,
    3.678794411714E-01,
    5.352614285190E-01,
    6.065306597126E-01,
    5.352614285190E-01,
    3.678794411714E-01,
    1.969116752042E-01,
    8.208499862390E-02,
    2.664909733636E-02,
    6.737946999085E-03,
    1.326780431027E-03,
    2.034683690106E-04,
    2.430083125933E-05,
    1.300729765407E-05,
    1.089087698551E-04,
    7.101743888425E-04,
    3.606563136016E-03,
    1.426423390900E-02,
    4.393693362341E-02,
    1.053992245619E-01,
    1.969116752042E-01,
    2.865047968602E-01,
    3.246524673584E-01,
    2.865047968602E-01,
    1.969116752042E-01,
    1.053992245619E-01,
    4.393693362341E-02,
    1.426423390900E-02,
    3.606563136016E-03,
    7.101743888425E-04,
    1.089087698551E-04,
    1.300729765407E-05,
    4.539992976248E-05,
    2.960447300569E-04,
    1.503439192978E-03,
    5.946217356472E-03,
    1.831563888873E-02,
    4.393693362341E-02,
    8.208499862390E-02,
    1.194329682667E-01,
    1.353352832366E-01,
    1.194329682667E-01,
    8.208499862390E-02,
    4.393693362341E-02,
    1.831563888873E-02,
    5.946217356472E-03,
    1.503439192978E-03,
    2.960447300569E-04,
    4.539992976248E-05,
    1.473919921529E-05,
    9.611165206139E-05,
    4.880952435234E-04,
    1.930454136228E-03,
    5.946217356472E-03,
    1.426423390900E-02,
    2.664909733636E-02,
    3.877420783172E-02,
    4.393693362341E-02,
    3.877420783172E-02,
    2.664909733636E-02,
    1.426423390900E-02,
    5.946217356472E-03,
    1.930454136228E-03,
    4.880952435234E-04,
    9.611165206139E-05,
    1.473919921529E-05,
    2.430083125933E-05,
    1.234098040867E-04,
    4.880952435234E-04,
    1.503439192978E-03,
    3.606563136016E-03,
    6.737946999085E-03,
    9.803655035822E-03,
    1.110899653824E-02,
    9.803655035822E-03,
    6.737946999085E-03,
    3.606563136016E-03,
    1.503439192978E-03,
    4.880952435234E-04,
    1.234098040867E-04,
    2.430083125933E-05,
    2.430083125933E-05,
    9.611165206139E-05,
    2.960447300569E-04,
    7.101743888425E-04,
    1.326780431027E-03,
    1.930454136228E-03,
    2.187491118183E-03,
    1.930454136228E-03,
    1.326780431027E-03,
    7.101743888425E-04,
    2.960447300569E-04,
    9.611165206139E-05,
    2.430083125933E-05,
    1.473919921529E-05,
    4.539992976248E-05,
    1.089087698551E-04,
    2.034683690106E-04,
    2.960447300569E-04,
    3.354626279025E-04,
    2.960447300569E-04,
    2.034683690106E-04,
    1.089087698551E-04,
    4.539992976248E-05,
    1.473919921529E-05,
    1.300729765407E-05,
    2.430083125933E-05,
    3.535750085041E-05,
    4.006529739295E-05,
    3.535750085041E-05,
    2.430083125933E-05,
    1.300729765407E-05};
  Sparse<t_complex> chirp(Nx, Ny);
  chirp.reserve(Vector<t_int>::Constant(Nx, Ny));
  Eigen::SparseVector<t_complex> grid(Nx * Ny);
  grid.reserve(grid_values.size());
  for (t_int i = 0; i < grid_ind.size(); ++i)
    grid.coeffRef(static_cast<t_int>(grid_ind[i] - 1)) = grid_values[i];

  CHECK(grid.nonZeros() == grid_values.size());
  for (t_int i = 0; i < chirp_ind.size(); ++i)
  {
    const auto subs = utilities::ind2sub(static_cast<t_int>(chirp_ind[i] - 1), Nx, Ny);
    chirp.coeffRef(subs(0), subs(1)) = chirp_values[i];
  }
  CHECK(chirp.nonZeros() == chirp_values.size());
  std::cout << "Testing convolution" << std::endl;
  auto test_output = wproj_utilities::row_wise_convolution(grid, chirp, Nx, Ny);
  std::cout << "Testing output" << std::endl;
  const std::vector<t_real> output_ind = {0.000000000000E+00,
    1.000000000000E+00,
    2.000000000000E+00,
    3.000000000000E+00,
    4.000000000000E+00,
    5.000000000000E+00,
    6.000000000000E+00,
    7.000000000000E+00,
    8.000000000000E+00,
    9.000000000000E+00,
    1.000000000000E+01,
    1.100000000000E+01,
    1.200000000000E+01,
    1.300000000000E+01,
    1.400000000000E+01,
    1.500000000000E+01,
    3.000000000000E+01,
    3.100000000000E+01,
    3.200000000000E+01,
    3.300000000000E+01,
    3.400000000000E+01,
    3.500000000000E+01,
    3.600000000000E+01,
    3.700000000000E+01,
    3.800000000000E+01,
    3.900000000000E+01,
    4.000000000000E+01,
    4.100000000000E+01,
    4.200000000000E+01,
    4.300000000000E+01,
    4.400000000000E+01,
    4.500000000000E+01,
    4.600000000000E+01,
    4.700000000000E+01,
    6.300000000000E+01,
    6.500000000000E+01,
    6.600000000000E+01,
    6.700000000000E+01,
    6.800000000000E+01,
    6.900000000000E+01,
    7.000000000000E+01,
    7.100000000000E+01,
    7.200000000000E+01,
    7.300000000000E+01,
    7.400000000000E+01,
    7.500000000000E+01,
    7.600000000000E+01,
    7.700000000000E+01,
    7.800000000000E+01,
    5.120000000000E+02,
    5.130000000000E+02,
    5.140000000000E+02,
    5.150000000000E+02,
    5.160000000000E+02,
    5.170000000000E+02,
    5.180000000000E+02,
    5.190000000000E+02,
    5.200000000000E+02,
    5.210000000000E+02,
    5.220000000000E+02,
    5.230000000000E+02,
    5.240000000000E+02,
    5.250000000000E+02,
    5.260000000000E+02,
    5.270000000000E+02,
    5.390000000000E+02,
    5.400000000000E+02,
    5.410000000000E+02,
    5.420000000000E+02,
    5.430000000000E+02,
    5.440000000000E+02,
    5.450000000000E+02,
    5.460000000000E+02,
    5.470000000000E+02,
    5.480000000000E+02,
    5.490000000000E+02,
    5.500000000000E+02,
    5.510000000000E+02,
    5.520000000000E+02,
    5.530000000000E+02,
    5.540000000000E+02,
    5.550000000000E+02,
    5.560000000000E+02,
    5.570000000000E+02,
    5.580000000000E+02,
    5.590000000000E+02,
    5.710000000000E+02,
    5.720000000000E+02,
    5.730000000000E+02,
    5.740000000000E+02,
    5.750000000000E+02,
    5.760000000000E+02,
    5.770000000000E+02,
    5.780000000000E+02,
    5.790000000000E+02,
    5.800000000000E+02,
    5.810000000000E+02,
    5.820000000000E+02,
    5.830000000000E+02,
    5.840000000000E+02,
    5.850000000000E+02,
    5.860000000000E+02,
    5.870000000000E+02,
    5.880000000000E+02,
    5.890000000000E+02,
    5.900000000000E+02,
    5.910000000000E+02,
    6.030000000000E+02,
    6.040000000000E+02,
    6.050000000000E+02,
    6.060000000000E+02,
    6.070000000000E+02,
    6.080000000000E+02,
    6.090000000000E+02,
    6.100000000000E+02,
    6.110000000000E+02,
    6.120000000000E+02,
    6.130000000000E+02,
    6.140000000000E+02,
    6.150000000000E+02,
    6.160000000000E+02,
    6.170000000000E+02,
    6.180000000000E+02,
    6.190000000000E+02,
    6.200000000000E+02,
    6.210000000000E+02,
    6.220000000000E+02,
    6.230000000000E+02,
    6.350000000000E+02,
    6.360000000000E+02,
    6.370000000000E+02,
    6.380000000000E+02,
    6.390000000000E+02,
    6.400000000000E+02,
    6.410000000000E+02,
    6.420000000000E+02,
    6.430000000000E+02,
    6.440000000000E+02,
    6.450000000000E+02,
    6.460000000000E+02,
    6.470000000000E+02,
    6.480000000000E+02,
    6.490000000000E+02,
    6.500000000000E+02,
    6.510000000000E+02,
    6.520000000000E+02,
    6.530000000000E+02,
    6.540000000000E+02,
    6.550000000000E+02,
    6.670000000000E+02,
    6.680000000000E+02,
    6.690000000000E+02,
    6.700000000000E+02,
    6.710000000000E+02,
    6.720000000000E+02,
    6.730000000000E+02,
    6.740000000000E+02,
    6.750000000000E+02,
    6.760000000000E+02,
    6.770000000000E+02,
    6.780000000000E+02,
    6.790000000000E+02,
    6.800000000000E+02,
    6.810000000000E+02,
    6.820000000000E+02,
    6.830000000000E+02,
    6.840000000000E+02,
    6.850000000000E+02,
    6.860000000000E+02,
    6.870000000000E+02,
    6.990000000000E+02,
    7.000000000000E+02,
    7.010000000000E+02,
    7.020000000000E+02,
    7.030000000000E+02,
    7.040000000000E+02,
    7.050000000000E+02,
    7.060000000000E+02,
    7.070000000000E+02,
    7.080000000000E+02,
    7.090000000000E+02,
    7.100000000000E+02,
    7.110000000000E+02,
    7.120000000000E+02,
    7.130000000000E+02,
    7.140000000000E+02,
    7.150000000000E+02,
    7.160000000000E+02,
    7.170000000000E+02,
    7.180000000000E+02,
    7.190000000000E+02,
    7.310000000000E+02,
    7.320000000000E+02,
    7.330000000000E+02,
    7.340000000000E+02,
    7.350000000000E+02,
    7.360000000000E+02,
    7.370000000000E+02,
    7.380000000000E+02,
    7.390000000000E+02,
    7.400000000000E+02,
    7.410000000000E+02,
    7.420000000000E+02,
    7.430000000000E+02,
    7.440000000000E+02,
    7.450000000000E+02,
    7.460000000000E+02,
    7.470000000000E+02,
    7.480000000000E+02,
    7.490000000000E+02,
    7.500000000000E+02,
    7.510000000000E+02,
    7.630000000000E+02,
    7.640000000000E+02,
    7.650000000000E+02,
    7.660000000000E+02,
    7.670000000000E+02,
    7.680000000000E+02,
    7.690000000000E+02,
    7.700000000000E+02,
    7.710000000000E+02,
    7.720000000000E+02,
    7.730000000000E+02,
    7.740000000000E+02,
    7.750000000000E+02,
    7.760000000000E+02,
    7.770000000000E+02,
    7.780000000000E+02,
    7.790000000000E+02,
    7.800000000000E+02,
    7.810000000000E+02,
    7.820000000000E+02,
    7.830000000000E+02,
    7.950000000000E+02,
    7.960000000000E+02,
    7.970000000000E+02,
    7.980000000000E+02,
    7.990000000000E+02,
    8.000000000000E+02,
    8.010000000000E+02,
    8.020000000000E+02,
    8.030000000000E+02,
    8.040000000000E+02,
    8.050000000000E+02,
    8.060000000000E+02,
    8.070000000000E+02,
    8.080000000000E+02,
    8.090000000000E+02,
    8.100000000000E+02,
    8.110000000000E+02,
    8.120000000000E+02,
    8.130000000000E+02,
    8.140000000000E+02,
    8.150000000000E+02,
    8.270000000000E+02,
    8.280000000000E+02,
    8.290000000000E+02,
    8.300000000000E+02,
    8.310000000000E+02,
    8.320000000000E+02,
    8.330000000000E+02,
    8.340000000000E+02,
    8.350000000000E+02,
    8.360000000000E+02,
    8.370000000000E+02,
    8.380000000000E+02,
    8.390000000000E+02,
    8.400000000000E+02,
    8.410000000000E+02,
    8.420000000000E+02,
    8.430000000000E+02,
    8.440000000000E+02,
    8.450000000000E+02,
    8.460000000000E+02,
    8.470000000000E+02,
    8.590000000000E+02,
    8.600000000000E+02,
    8.610000000000E+02,
    8.620000000000E+02,
    8.630000000000E+02,
    8.640000000000E+02,
    8.650000000000E+02,
    8.660000000000E+02,
    8.670000000000E+02,
    8.680000000000E+02,
    8.690000000000E+02,
    8.700000000000E+02,
    8.710000000000E+02,
    8.720000000000E+02,
    8.730000000000E+02,
    8.740000000000E+02,
    8.750000000000E+02,
    8.760000000000E+02,
    8.770000000000E+02,
    8.780000000000E+02,
    8.790000000000E+02,
    8.910000000000E+02,
    8.920000000000E+02,
    8.930000000000E+02,
    8.940000000000E+02,
    8.950000000000E+02,
    8.960000000000E+02,
    8.970000000000E+02,
    8.980000000000E+02,
    8.990000000000E+02,
    9.000000000000E+02,
    9.010000000000E+02,
    9.020000000000E+02,
    9.030000000000E+02,
    9.040000000000E+02,
    9.050000000000E+02,
    9.060000000000E+02,
    9.070000000000E+02,
    9.080000000000E+02,
    9.090000000000E+02,
    9.100000000000E+02,
    9.110000000000E+02,
    9.230000000000E+02,
    9.240000000000E+02,
    9.250000000000E+02,
    9.260000000000E+02,
    9.270000000000E+02,
    9.280000000000E+02,
    9.290000000000E+02,
    9.300000000000E+02,
    9.310000000000E+02,
    9.320000000000E+02,
    9.330000000000E+02,
    9.340000000000E+02,
    9.350000000000E+02,
    9.360000000000E+02,
    9.370000000000E+02,
    9.380000000000E+02,
    9.390000000000E+02,
    9.400000000000E+02,
    9.410000000000E+02,
    9.420000000000E+02,
    9.430000000000E+02,
    9.560000000000E+02,
    9.570000000000E+02,
    9.580000000000E+02,
    9.590000000000E+02,
    9.600000000000E+02,
    9.610000000000E+02,
    9.620000000000E+02,
    9.630000000000E+02,
    9.640000000000E+02,
    9.650000000000E+02,
    9.660000000000E+02,
    9.670000000000E+02,
    9.680000000000E+02,
    9.690000000000E+02,
    9.700000000000E+02,
    9.710000000000E+02,
    9.720000000000E+02,
    9.730000000000E+02,
    9.740000000000E+02,
    9.750000000000E+02,
    9.880000000000E+02,
    9.890000000000E+02,
    9.900000000000E+02,
    9.910000000000E+02,
    9.920000000000E+02,
    9.930000000000E+02,
    9.940000000000E+02,
    9.950000000000E+02,
    9.960000000000E+02,
    9.970000000000E+02,
    9.980000000000E+02,
    9.990000000000E+02,
    1.000000000000E+03,
    1.001000000000E+03,
    1.002000000000E+03,
    1.003000000000E+03,
    1.004000000000E+03,
    1.005000000000E+03,
    1.006000000000E+03,
    1.007000000000E+03,
    1.021000000000E+03,
    1.022000000000E+03,
    1.023000000000E+03};
  const std::vector<t_real> output_values = {-4.808346121883E-08,
    2.120356510109E-07,
    3.514643872291E-07,
    -1.868034843778E-06,
    1.440848407517E-06,
    -1.878050428172E-07,
    2.081763266490E-07,
    2.203767174367E-07,
    1.303248851591E-07,
    -1.415360423091E-07,
    1.019395594121E-06,
    -2.027690836813E-06,
    7.441617386207E-07,
    2.003817734770E-07,
    -8.535685582903E-08,
    4.974971970463E-09,
    -1.988318232438E-11,
    1.859918003168E-09,
    6.420385422138E-10,
    -2.539383189662E-09,
    -3.977092795356E-08,
    2.381683386321E-07,
    -1.735240000889E-07,
    -5.079552788940E-08,
    -1.756948656474E-07,
    -1.937952194890E-07,
    -1.126358835315E-07,
    1.428889932609E-08,
    -7.342883906347E-08,
    2.784364929601E-07,
    -7.690846296427E-08,
    -6.443867844480E-10,
    1.198108143765E-09,
    -4.511194463035E-11,
    -1.205975969239E-11,
    -1.064270057445E-11,
    5.794956681466E-10,
    -3.555376896066E-09,
    2.568524012292E-09,
    9.219172321766E-10,
    2.949532087474E-09,
    3.255976426773E-09,
    1.891784144112E-09,
    -2.051234715888E-10,
    9.726344916742E-10,
    -4.200470082090E-09,
    1.106554330811E-09,
    -3.983124179746E-11,
    1.657662881499E-14,
    -6.635413972497E-06,
    -8.110605414060E-06,
    -2.618059912603E-05,
    -3.427738621061E-05,
    1.011225002478E-05,
    1.405133314692E-04,
    2.925232935802E-04,
    3.247452353981E-04,
    1.882402622401E-04,
    4.317855389785E-06,
    -8.811199112327E-05,
    -7.829784687129E-05,
    -3.689408998045E-05,
    -8.638759796677E-06,
    -4.938125743288E-06,
    4.868790444992E-06,
    -7.799386386934E-11,
    -3.444656720775E-10,
    2.278114399514E-07,
    -1.756918202832E-06,
    4.017399331194E-06,
    -8.779424840337E-06,
    -4.194600158315E-05,
    -1.070084152699E-04,
    -1.423532550676E-04,
    4.195412165667E-05,
    5.830667283141E-04,
    1.213834997963E-03,
    1.347541078596E-03,
    7.811091661416E-04,
    1.791811434985E-05,
    -3.656304567613E-04,
    -3.249434239575E-04,
    -1.521686663678E-04,
    -4.174160786686E-05,
    -4.097232456350E-06,
    1.423444533329E-07,
    1.860980970214E-09,
    -1.076260414984E-07,
    9.412434000361E-07,
    -1.382720404659E-06,
    -1.522543410107E-06,
    -2.234919787704E-05,
    -9.688320783788E-05,
    -2.493021800389E-04,
    -3.315250159581E-04,
    9.770741057119E-05,
    1.357910833011E-03,
    2.826914336159E-03,
    3.138303970505E-03,
    1.819134152151E-03,
    4.172970331021E-05,
    -8.515209977544E-04,
    -7.567634688589E-04,
    -3.544297111840E-04,
    -9.670642522165E-05,
    -1.136570703793E-05,
    -7.300173316928E-08,
    -6.248284652699E-09,
    3.410867642800E-07,
    -2.188321309718E-06,
    4.490691845413E-06,
    -5.690191504804E-06,
    -2.990898587171E-05,
    -1.260584996245E-04,
    -3.243762570955E-04,
    -4.313615256868E-04,
    1.271313287478E-04,
    1.766836389397E-03,
    3.678220246434E-03,
    4.083382738601E-03,
    2.366953955355E-03,
    5.429631794279E-05,
    -1.107950720028E-03,
    -9.846576147410E-04,
    -4.611632351315E-04,
    -1.258374597180E-04,
    -1.517012275004E-05,
    3.569616127909E-06,
    8.354522192957E-10,
    -6.083982044221E-08,
    1.051345610061E-06,
    -2.169180982265E-06,
    -2.346475236353E-06,
    -9.803201369696E-06,
    -4.184507669458E-05,
    -1.076660497176E-04,
    -1.431762947328E-04,
    4.219707023192E-05,
    5.864433255445E-04,
    1.220864436769E-03,
    1.355344822569E-03,
    7.856326467574E-04,
    1.802187992643E-05,
    -3.677478620497E-04,
    -3.268247640680E-04,
    -1.530679946601E-04,
    -4.176867968779E-05,
    -4.972375765738E-06,
    6.951249739957E-07,
    -8.464937172342E-10,
    4.309541633468E-08,
    -1.415931357104E-07,
    2.987885683816E-07,
    -1.442998030969E-06,
    3.802777513150E-05,
    1.617708332330E-04,
    4.162423296879E-04,
    5.535267094363E-04,
    -1.631359819509E-04,
    -2.267219198997E-03,
    -4.719922914709E-03,
    -5.239830805710E-03,
    -3.037295067573E-03,
    -6.967348828317E-05,
    1.421731609709E-03,
    1.263520868133E-03,
    5.917685156077E-04,
    1.614786482189E-04,
    1.928847170517E-05,
    -3.191395282541E-06,
    2.118103682802E-09,
    -1.015904896048E-07,
    4.339873734713E-08,
    -1.080798172152E-07,
    4.895459897186E-06,
    7.932618807761E-05,
    3.374506024709E-04,
    8.682729549611E-04,
    1.154645352875E-03,
    -3.402983094317E-04,
    -4.729372706762E-03,
    -9.845662307693E-03,
    -1.093017949545E-02,
    -6.335735160199E-03,
    -1.453374662744E-04,
    2.965702952000E-03,
    2.635678592884E-03,
    1.234416975506E-03,
    3.368411360086E-04,
    4.023587866709E-05,
    -6.661236506459E-06,
    4.409040491963E-09,
    -2.113930245534E-07,
    8.647741393396E-08,
    -2.170355593882E-07,
    1.020633660708E-05,
    7.849778474407E-05,
    3.339421063895E-04,
    8.592451499956E-04,
    1.142640011776E-03,
    -3.367600825033E-04,
    -4.680199397929E-03,
    -9.743292749753E-03,
    -1.081653374891E-02,
    -6.269859814559E-03,
    -1.438263305369E-04,
    2.934867271201E-03,
    2.608274316362E-03,
    1.221582214761E-03,
    3.333388873675E-04,
    3.981569430704E-05,
    -6.577754362178E-06,
    4.395775806138E-09,
    -2.110298182269E-07,
    9.980069337240E-08,
    -2.443253622219E-07,
    1.011949716640E-05,
    4.302276730737E-05,
    1.826242897154E-04,
    4.699070480526E-04,
    6.248910377876E-04,
    -1.841685528882E-04,
    -2.559524109679E-03,
    -5.328446628083E-03,
    -5.915384486768E-03,
    -3.428883258002E-03,
    -7.865625570961E-05,
    1.605030662298E-03,
    1.426422344385E-03,
    6.680632307967E-04,
    1.822967147423E-04,
    2.182206047449E-05,
    -3.965609271439E-06,
    1.560210077751E-09,
    -6.788920421843E-08,
    -3.137792617235E-07,
    6.316245573079E-07,
    5.034846985894E-06,
    7.873828224979E-06,
    3.524890857931E-05,
    9.066653691673E-05,
    1.205699221428E-04,
    -3.553449603564E-05,
    -4.938486940484E-04,
    -1.028099871626E-03,
    -1.141346898253E-03,
    -6.615876414702E-04,
    -1.517637165991E-05,
    3.096834655655E-04,
    2.752217919002E-04,
    1.288998268786E-04,
    3.517603255148E-05,
    3.996700763848E-06,
    9.475114320400E-07,
    4.270584779009E-09,
    -2.366348213465E-07,
    1.671164947745E-06,
    -3.468518697831E-06,
    3.300390832967E-06,
    -5.780401054682E-06,
    -2.512173515044E-05,
    -6.480743434646E-05,
    -8.617492224096E-05,
    2.539759740497E-05,
    3.529688546222E-04,
    7.348146071833E-04,
    8.157557410960E-04,
    4.728570407418E-04,
    1.084701971812E-05,
    -2.213403001003E-04,
    -1.967094520064E-04,
    -9.213085126692E-05,
    -2.509942556733E-05,
    -3.022443728353E-06,
    -9.500420616035E-07,
    -4.868223909215E-09,
    2.708443678607E-07,
    -1.955934829707E-06,
    3.882270493414E-06,
    -2.918098328961E-06,
    -3.554069060069E-06,
    -2.503425816824E-05,
    -6.238115086211E-05,
    -8.310011465483E-05,
    2.448988734191E-05,
    3.403527684878E-04,
    7.085502885520E-04,
    7.865983612328E-04,
    4.559558144502E-04,
    1.045931849740E-05,
    -2.134289703305E-04,
    -1.896805118695E-04,
    -8.878194008305E-05,
    -2.473221235673E-05,
    -1.099470664508E-06,
    -1.952677614408E-06,
    7.026791599516E-10,
    -3.953945289268E-08,
    2.867787740202E-07,
    3.066946220369E-07,
    -2.893060266189E-06,
    -7.900298816413E-06,
    -7.380067699735E-06,
    -2.736150525732E-05,
    -3.535656314082E-05,
    1.045197902416E-05,
    1.450335259439E-04,
    3.019400162172E-04,
    3.351991097855E-04,
    1.942999328269E-04,
    4.455284694041E-06,
    -9.093705920320E-05,
    -8.081834970298E-05,
    -3.829622303706E-05,
    -8.091676936748E-06,
    -6.248678937046E-06,
    5.513336933257E-06,
    -1.064270057445E-11,
    -3.981044064630E-09,
    2.494200756377E-07,
    -1.808685877102E-06,
    4.442714013523E-06,
    5.365789876610E-06,
    -8.028498590720E-06,
    -4.806808208052E-06,
    -8.789652002958E-06,
    2.217547413395E-06,
    3.722979768842E-05,
    7.731116469475E-05,
    8.583060598064E-05,
    4.975131804911E-05,
    1.188121259744E-06,
    -2.363572596560E-05,
    -2.021546876158E-05,
    -8.489463820873E-06,
    -7.251297951515E-06,
    5.945423224607E-06,
    -3.916919784584E-06,
    7.816237253959E-10,
    -5.048587787866E-08,
    6.985276319251E-07,
    -3.183398581553E-06,
    -3.152970851533E-06,
    4.173333418624E-06,
    -2.788147883926E-06,
    -3.882776527209E-06,
    2.659486061842E-06,
    5.195194747067E-06,
    1.176266985825E-05,
    1.304138360843E-05,
    7.563588336049E-06,
    -5.499332490240E-08,
    -1.835980101183E-06,
    -6.059122151169E-06,
    -1.940255945850E-06,
    3.916516539606E-06,
    -3.738570765606E-06,
    1.313368841967E-06,
    -1.205975969239E-11,
    1.950469880573E-09,
    -8.196833536830E-08,
    8.491015931396E-07,
    6.736760226587E-07,
    -1.691466602676E-06,
    -8.910478626014E-08,
    3.952631474868E-06,
    -3.202597701004E-06,
    8.239851334679E-07,
    3.695730699556E-07,
    4.343852738807E-07,
    2.459931340455E-07,
    3.302762978158E-07,
    -2.540632223563E-06,
    4.256809212783E-06,
    -1.205397188838E-06,
    -1.665158287619E-06,
    9.633623249246E-07,
    -1.581152903972E-07,
    -1.988318232438E-11,
    2.368736157677E-09,
    -8.109261432466E-08};
  for (t_int i = 0; i < output_ind.size(); ++i)
  {
    CHECK(std::abs(test_output.coeffRef(0, static_cast<t_int>(output_ind[i])) - output_values[i]) <= 1e-12);
  }
}
